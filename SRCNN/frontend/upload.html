<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload X-ray - DignoAid</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <video autoplay muted loop id="background-video">
        <source src="asset/vedio/x_ray.mp4" type="video/mp4">
        <source src="asset/vedio/x_ray.webm" type="video/webm">
    </video>

    <header class="main-header">
        <div class="container navbar">
            <a href="index.html" class="logo">
                <i class="fas fa-heartbeat"></i>
                <span>DignoAid</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="upload.html" class="active">Upload</a></li>
                <li><a href="results.html">Results</a></li>
                <li><a href="reports.html">Reports</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
            <div class="header-actions">
                <a href="upload.html"><button class="start-analysis-btn">Start Analysis</button></a>
            </div>
        </div>
    </header>

    <main>
        <section class="upload-section">
            <div class="container">
                <h2>Upload X-ray Image</h2>
                <p>Upload your X-ray image for AI-powered enhancement and disease detection analysis.</p>

                <div class="upload-box" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drop your X-ray image here<br>or click to browse files</p>
                    <button class="choose-file-btn">Choose File</button>
                </div>

                <div class="supported-formats">
                    <span class="format-pill">JPG</span>
                    <span class="format-pill">PNG</span>
                    <span class="format-pill">DICOM</span>
                    <span class="format-pill">Max 10MB</span>
                </div>

                <form id="uploadForm" enctype="multipart/form-data">
                    <input type="file" id="fileInput" name="file" accept=".png,.jpg,.jpeg,.dcm" style="display:none;">
                    <button type="submit" class="choose-file-btn" style="margin-top: 20px;">Upload & Analyze</button>
                </form>

                <div id="result" style="margin-top:30px; text-align:center; color:white;"></div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container footer-content">
            <div class="footer-logo">
                <a href="index.html" class="logo">
                    <i class="fas fa-heartbeat"></i>
                    <span>DignoAid</span>
                </a>
                <p>Advanced AI technology for X-ray enhancement and medical disease detection. Empowering healthcare professionals with cutting-edge diagnostic tools.</p>
            </div>
            <div class="footer-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="upload.html">Upload X-ray</a></li>
                    <li><a href="results.html">View Results</a></li>
                    <li><a href="reports.html">Generate Reports</a></li>
                </ul>
            </div>
            <div class="footer-features">
                <h3>Features</h3>
                <ul>
                    <li><a href="#">Super-Resolution AI</a></li>
                    <li><a href="#">CNN Classification</a></li>
                    <li><a href="#">Instant PDF Reports</a></li>
                    <li><a href="#">Disease Detection</a></li>
                </ul>
            </div>
        </div>
        <div class="container footer-bottom">
            <p>© 2024 DignoAid. All rights reserved.</p>
            <p>Made with ❤️ for healthcare</p>
        </div>
    </footer>

<!-- ✅ FIXED SCRIPT BELOW -->
<script>
document.getElementById("uploadForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const fileInput = document.getElementById("fileInput");
    const file = fileInput.files[0];

    if (!file) {
        alert("Please select an X-ray image first!");
        return;
    }

    const formData = new FormData();
    formData.append("file", file);

    try {
        // Step 1: Upload image
        const uploadResponse = await fetch("http://127.0.0.1:5000/upload", {
            method: "POST",
            body: formData
        });

        const uploadData = await uploadResponse.json();

        if (uploadData.error) {
            document.getElementById("result").innerHTML = `<p style='color:red;'>${uploadData.error}</p>`;
            return;
        }

        // Show uploaded image
        document.getElementById("result").innerHTML = `
            <p style='color:lightgreen;'>${uploadData.message}</p>
            <img src="${uploadData.file_url}" width="300" style="border-radius:10px; box-shadow:0 0 10px #000;">
            <p>Analyzing image...</p>
        `;

        // Step 2: Send for prediction
        const predictResponse = await fetch("http://127.0.0.1:5000/predict", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ filename: uploadData.filename })
        });

        const predictionData = await predictResponse.json();

        if (predictionData.error) {
            document.getElementById("result").innerHTML += `<p style='color:red;'>${predictionData.error}</p>`;
            return;
        }

        // Show prediction
        document.getElementById("result").innerHTML += `
            <div style="margin-top:15px;">
                <h3 style="color:yellow;">Prediction Result</h3>
                <p><strong>Disease:</strong> ${predictionData.prediction}</p>
                <p><strong>Confidence:</strong> ${(predictionData.confidence * 100).toFixed(2)}%</p>
            </div>
        `;
    } catch (error) {
        console.error("Error:", error);
        document.getElementById("result").innerHTML = `<p style='color:red;'>Something went wrong: ${error.message}</p>`;
    }
});
</script>

</body>
</html>
